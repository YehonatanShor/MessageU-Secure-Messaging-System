name: Code Compilation Check

# Controls when the workflow will run
on:
  push:
    # Trigger the workflow on push events to the main branch
    branches: ["main"]
  pull_request:
    # Trigger the workflow on pull request events targeting the main branch
    branches: ["main"]

jobs:
  check-compilation:
    # Use the latest Windows runner provided by GitHub
    runs-on: windows-latest

    defaults:
      run:
        # Use MSYS2 shell to provide necessary GCC/G++ tools
        shell: msys2 {0}

    steps:
      # 1. Check out the current repository so the workflow can access it
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Setup MSYS2 and install required build tools and libraries
      - name: Setup MSYS2 and Libraries
        uses: msys2/setup-msys2@v2
        with:
          msystem: UCRT64
          update: true
          install: >-
            mingw-w64-ucrt-x86_64-gcc
            mingw-w64-ucrt-x86_64-boost
            mingw-w64-ucrt-x86_64-cryptopp

      # 3. Verify that the client code compiles without errors
      - name: Verify Compilation
        run: |
          cd Client
          # Compile the source files. 
          # Output is redirected to /dev/null as we only need to verify if compilation succeeds.
          g++ main.cpp MessageUClient.cpp RSAWrapper.cpp Base64Wrapper.cpp AESWrapper.cpp -o /dev/null -std=c++17 -lWs2_32 -lpthread -lcryptopp
